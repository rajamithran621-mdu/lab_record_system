{% extends "base.html" %}
{% block title %}Students â€” Lab Record Admin{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
  <h4 class="fw-bold mb-0"><i class="bi bi-people me-2 text-primary"></i>Student Management</h4>
  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary btn-sm">
    <i class="bi bi-arrow-left me-1"></i>Dashboard
  </a>
</div>

<div class="row g-4">

  <!-- Add Student Form -->
  <div class="col-lg-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-white fw-semibold border-bottom">
        <i class="bi bi-person-plus me-2 text-success"></i>Add New Student
      </div>
      <div class="card-body p-4">
        <form method="POST" action="{{ url_for('admin_add_student') }}">
          <div class="mb-3">
            <label class="form-label fw-semibold small">Full Name <span class="text-danger">*</span></label>
            <input type="text" name="name" class="form-control" placeholder="e.g. John Doe" required/>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold small">Register Number <span class="text-danger">*</span></label>
            <input type="text" name="reg_no" class="form-control text-uppercase" placeholder="e.g. CS2024001" required/>
          </div>
          <div class="mb-4">
            <label class="form-label fw-semibold small">Department <span class="text-danger">*</span></label>
            <select name="dept" class="form-select" required>
              <option value="" disabled selected>Select Department</option>
              <option>Computer Science</option>
              <option>Information Technology</option>
              <option>Electronics & Communication</option>
              <option>Electrical Engineering</option>
              <option>Mechanical Engineering</option>
              <option>Civil Engineering</option>
              <option>MBA</option>
              <option>MCA</option>
              <option>Other</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success w-100">
            <i class="bi bi-plus-circle me-2"></i>Add Student
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Students Table -->
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white fw-semibold border-bottom d-flex justify-content-between">
        <span><i class="bi bi-table me-2 text-primary"></i>Registered Students</span>
        <span class="badge bg-primary">{{ students|length }} total</span>
      </div>
      <div class="card-body p-0">
        {% if students %}
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Reg No</th>
                <th>Department</th>
                <th class="text-center">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for s in students %}
              <tr>
                <td class="text-muted small">{{ loop.index }}</td>
                <td class="fw-semibold">{{ s.name }}</td>
                <td><span class="badge bg-secondary">{{ s.reg_no }}</span></td>
                <td>{{ s.dept }}</td>
                <td class="text-center">
                  <!-- Delete Button triggers modal -->
                  <button
                    class="btn btn-sm btn-outline-danger"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal"
                    data-id="{{ s.id }}"
                    data-name="{{ s.name }}"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center text-muted py-5">
          <i class="bi bi-person-x display-6 d-block mb-2"></i>
          No students registered yet. Add one using the form.
        </div>
        {% endif %}
      </div>
    </div>
  </div>

</div><!-- /row -->

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header border-0 bg-danger text-white">
        <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>Confirm Delete</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body py-4">
        <p class="mb-0">Are you sure you want to delete <strong id="student-name"></strong>?
          <br/><small class="text-muted">All lab entries for this student will also be deleted.</small>
        </p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form id="deleteForm" method="POST">
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-trash me-1"></i>Delete
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
  // Populate modal with student info before showing
  document.getElementById('deleteModal').addEventListener('show.bs.modal', function(event) {
    const btn = event.relatedTarget;
    const id   = btn.getAttribute('data-id');
    const name = btn.getAttribute('data-name');
    document.getElementById('student-name').textContent = name;
    document.getElementById('deleteForm').action = `/admin/students/delete/${id}`;
  });
</script>
{% endblock %}
